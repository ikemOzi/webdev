{% extends "base.html "%}

{% block title %} Take Photo {% endblock %}

{% block content %}
<style>
    body{
        margin:0;
        width: 100%;
        height: 100%;
        padding: 0;
        font-family:sans-serif;
    }

    .takePhoto{
        border-style: dashed;
        width: 500px;
        height: 400px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color:hsl(0, 7%, 5%);
    }

    #startButton{
        font-size: 12px;
        width:100px;
        height: 70px;
        border-radius: 25px;
        background-color: hsl(120, 81%, 55%);
        font-family: sans-serif;
        font-weight: bold; 
    }

    #startButton:hover{
        background-color: hsl(120, 81%, 65%);
    }

    .otherButtons{
        display: flex;
        justify-content: space-between;
        width: 500px;
        margin: 0 auto;
        border-style:none
        
    }

    #TakePhoto{
        background-color: hsl(207, 75%, 70%);
        height: 40px;
        border-radius:25px ;
        width:140px;

    }

    #TakePhoto:hover{
        background-color: hsl(207, 75%, 80%);
    }

    #STOP{
       background-color: hsl(0, 98%, 58%);
       height: 40px;
       border-radius:25px ; 
       width: 100px;
    }

    #STOP:hover{
        background-color: hsl(0, 98%, 68%);
    }

  
</style>



<div id = container>
    <h1 style="text-align:center ;"> What Is My Emotion? </h1>
    <div id="summary" style="text-align: center; font-size: 20px;">
        <p>
            Let our AI decide what emotion you are feeling at the moment. 
            Do you want to know what emotion others see on your face? 
            Find it out now by taking a selfie.
        </p>
    </div>

    <div>
        <h3>Tips for accurate prediction</h3>
        <div class="card mb-3" style="max-width: 1000px;">
        <div class="row g-0">
            <div class="col-md-4">
            <img src="{{url_for('static', filename='staring.jpg')}}" class="img-fluid rounded-start" alt="staring" style="width: 400px; object-fit: cover;">
            </div>
            <div class="col-md-8">
            <div class="card-body">
                <h5 class="card-title">Selfie Guidlines</h5>
                <ul>
                    <li>‚úÖ look straight at camera</li>
                    <li>‚ùå Dont take selfie with more than one person</li>
                    <li>‚ùå Dont cover face</li>
                    <li>‚ùå No sunglasses or masks</li>
                    
                </ul>
                
            </div>
            </div>
        </div>
        </div>
    </div>

    <div>
        <h3 style="text-align: center;"> Take Photo </h3>
        <div class="takePhoto">
            <!-- <img src="{{url_for('photo')}}"> -->
            <button id="startButton"> Start </button>
        </div>
        <div class="otherButtons">

        </div>
        <div id="prediction">YOUR EMOTION IS: </div>
    </div>
</div>

<script>
    let container = document.getElementsByClassName('takePhoto');
    let button = document.getElementById('startButton');
    let otherContainer = document.getElementsByClassName("otherButtons");
    let button1 = null;
    let button2 = null;
    let img = null;
    let content = document.getElementById('prediction')

    function startSelfie(event){
        img = document.createElement('img');
        img.src = "photo" + "?t=" + new Date().getTime();;
        img.style.height = '400px';
        img.style.width = '500px';
        container[0].append(img);
        button.style.display = "none";  // hide button
        button1 = document.createElement('button');
        button2 = document.createElement('button');
        button1.id = 'TakePhoto';
        button2.id = 'STOP';
        button1.textContent = 'Take Selfie üòä';
        button2.textContent = 'Clear';
        
        otherContainer[0].append(button1);
        otherContainer[0].append(button2);

        button1.addEventListener('click', async function () {
            try {
                const response = await fetch("/takeSelfie");
                const data = await response.json();

                if (data.error) {
                    content.textContent = "Error: " + data.error;
                } else {
                    img.src = data.image;
                    content.textContent = "YOUR EMOTION IS: " + data.prediction;
                }
            } catch (error) {
                content.textContent = "Error: Could not fetch data.";
                console.error(error);
            }   
        });

        button2.addEventListener('click', function(){
            if(img != null){
                container[0].removeChild(img);
                otherContainer[0].removeChild(button1);
                otherContainer[0].removeChild(button2);
                button.style.display = 'block';
                fetch("/clearPhoto");
            }
        })
    }
    button.addEventListener('click', startSelfie);




</script>

{% endblock %}